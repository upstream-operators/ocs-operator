Subject: [PATCH] Deployment workflow
---
Index: .github/workflows/deploy.yml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/.github/workflows/deploy.yml b/.github/workflows/deploy.yml
new file mode 100644
--- /dev/null	(revision c7c0391590fe30d51f224729f0cb85beece52e58)
+++ b/.github/workflows/deploy.yml	(revision c7c0391590fe30d51f224729f0cb85beece52e58)
@@ -0,0 +1,59 @@
+name: Deploy Operator
+
+on:
+  push:
+    branches:
+      - "release-[0-9]+.[0-9]+"
+
+env:
+  IMAGE_FROM: "quay.io/ocs-dev/"
+  IMAGE_TO: "ghcr.io/${{ github.repository }}"
+
+jobs:
+  deploy:
+    name: Deploy Operator
+    runs-on: ubuntu-latest
+
+    steps:
+      - name: Checkout
+        uses: actions/checkout@v2
+        with:
+          fetch-depth: 0
+
+      - name: Set up Go
+        uses: actions/setup-go@v4
+        with:
+          go-version-file: go.mod
+
+      - name: Replace Quay with ghcr.io
+        run: |
+          find . -type f -name '*' -exec sed -i 's/${{ env.IMAGE_FROM }}/${{ env.IMAGE_TO }}/g' {} +
+
+      - name: Login to ghcr.io
+        uses: docker/login-action@v3
+        with:
+          registry: ghcr.io
+          username: ${{ github.actor }}
+          password: ${{ secrets.GITHUB_TOKEN }}
+
+      - name: Build and Push Images
+        run: |
+          branch="${GITHUB_HEAD_REF:-${GITHUB_REF#refs/heads/}}"
+          version="${branch#release-}"
+          tag=$(date "+${version}-%Y-%m-%d-%H%M%S")
+          
+          make ocs-operator
+          podman push ${IMAGE_TO}/ocs-operator:${tag}
+          podman push ${IMAGE_TO}/ocs-operator:${version}
+          
+          make ocs-metrics-exporter
+          podman push ${IMAGE_TO}/ocs-metrics-exporter:${tag}
+          podman push ${IMAGE_TO}/ocs-metrics-exporter:${version}
+          
+          make operator-bundle
+          podman push ${IMAGE_TO}/ocs-operator-bundle:${tag}
+          podman push ${IMAGE_TO}/ocs-operator-bundle:${version}
+          
+          make operator-catalog
+          podman push ${IMAGE_TO}/ocs-operator-catalog:${tag}
+          podman push ${IMAGE_TO}/ocs-operator-catalog:${version}
